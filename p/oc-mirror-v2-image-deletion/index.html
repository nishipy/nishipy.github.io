<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=google-site-verification content="E9eDpgSuhyY-l83ZkKb5xbL0_aUZixIZKfCXG2APiFM"><meta name=description content="Header Photo by Ivan Rohovchenko on Unsplash
oc-mirror plugin v2 インターネット接続性のない環境では、OpenShiftのインストールに必要なコンテナイメージやOperatorが使うコンテナイメージを、Red Hatが公開するインターネット上のコンテナレジストリからミラーレジストリにミラーリングする必要があります。そんなときに便利なoc-mirror pluginですが、バグの多いの機能の改善や再実装、新機能の追加をしたoc-mirror plugin v2の開発が進められています。詳細は、OpenShift 4.16のリリースノートのこの辺りをご確認ください。
なお、OpenShift 4.16時点では、oc-mirror plugin v2によるミラーリングはTech Previewです。
今回は、oc-mirror plugin v2で追加された、ミラーレジストリ上にあるイメージ削除の機能で遊んでみたいと思います。
oc-mirror pluginによるミラーリングとイメージ削除 従来のoc-mirror v1では、ミラーリング実行時に、前回までのミラーリングの履歴から自動でイメージをプルーニングするため、利用者が明示的にイメージを削除することはありませんでした。 この挙動は一見便利そうですが、ImageSetConfiguration という設定ファイルをわりと作成・更新しないと意図しないイメージを消してしまうこともしばしばありました。またバグが報告されることも多かったそうで、oc-mirror plugin v2では、自動でプルーニングを行わないように根本的に実装が見直されています。
DeleteImageSetConfiguration の導入 oc-mirror では、ImageSetConfiguration という設定ファイルにミラーリング対象のコンテナイメージを定義していました。v1では、このファイルの変更履歴から削除対象となるイメージを自動で算出していたわけですが、v2からは DeleteImageSetConfiguration が導入され、ImageSetConfiguration と同じような書式で削除したいイメージを明示的に定義することができます。
oc-mirror v2でイメージ削除してみる イメージのミラーリング ミラーレジストリからイメージを削除してみたいのですが、そもそも消すイメージがないので、まずミラーリングを実行します。以下のような内容の ImageSetConfiguration で、OpenShift 4.16.5 と 4.16.6のリリースイメージをミラーリングしてみます。v1と比較して、CRD(のようなもの)のkindは同じですが、apiVersion が異なるため注意してください。
1 2 3 4 5 6 7 8 kind: ImageSetConfiguration apiVersion: mirror.openshift.io/v2alpha1 mirror: platform: channels: - name: stable-4.16 minVersion: 4.16.5 maxVersion: 4."><title>oc-mirror v2で遊んでみた</title><link rel=canonical href=https://blog.nishipy.com/p/oc-mirror-v2-image-deletion/><link rel=stylesheet href=/scss/style.min.705a41b44c071e70a903c27edfdc8dd99defe50138c4cf4fc42239f4f01aca9e.css><meta property="og:title" content="oc-mirror v2で遊んでみた"><meta property="og:description" content="Header Photo by Ivan Rohovchenko on Unsplash
oc-mirror plugin v2 インターネット接続性のない環境では、OpenShiftのインストールに必要なコンテナイメージやOperatorが使うコンテナイメージを、Red Hatが公開するインターネット上のコンテナレジストリからミラーレジストリにミラーリングする必要があります。そんなときに便利なoc-mirror pluginですが、バグの多いの機能の改善や再実装、新機能の追加をしたoc-mirror plugin v2の開発が進められています。詳細は、OpenShift 4.16のリリースノートのこの辺りをご確認ください。
なお、OpenShift 4.16時点では、oc-mirror plugin v2によるミラーリングはTech Previewです。
今回は、oc-mirror plugin v2で追加された、ミラーレジストリ上にあるイメージ削除の機能で遊んでみたいと思います。
oc-mirror pluginによるミラーリングとイメージ削除 従来のoc-mirror v1では、ミラーリング実行時に、前回までのミラーリングの履歴から自動でイメージをプルーニングするため、利用者が明示的にイメージを削除することはありませんでした。 この挙動は一見便利そうですが、ImageSetConfiguration という設定ファイルをわりと作成・更新しないと意図しないイメージを消してしまうこともしばしばありました。またバグが報告されることも多かったそうで、oc-mirror plugin v2では、自動でプルーニングを行わないように根本的に実装が見直されています。
DeleteImageSetConfiguration の導入 oc-mirror では、ImageSetConfiguration という設定ファイルにミラーリング対象のコンテナイメージを定義していました。v1では、このファイルの変更履歴から削除対象となるイメージを自動で算出していたわけですが、v2からは DeleteImageSetConfiguration が導入され、ImageSetConfiguration と同じような書式で削除したいイメージを明示的に定義することができます。
oc-mirror v2でイメージ削除してみる イメージのミラーリング ミラーレジストリからイメージを削除してみたいのですが、そもそも消すイメージがないので、まずミラーリングを実行します。以下のような内容の ImageSetConfiguration で、OpenShift 4.16.5 と 4.16.6のリリースイメージをミラーリングしてみます。v1と比較して、CRD(のようなもの)のkindは同じですが、apiVersion が異なるため注意してください。
1 2 3 4 5 6 7 8 kind: ImageSetConfiguration apiVersion: mirror.openshift.io/v2alpha1 mirror: platform: channels: - name: stable-4.16 minVersion: 4.16.5 maxVersion: 4."><meta property="og:url" content="https://blog.nishipy.com/p/oc-mirror-v2-image-deletion/"><meta property="og:site_name" content="/home/nishipy"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="openshift"><meta property="article:tag" content="podman"><meta property="article:published_time" content="2024-09-10T00:00:00+09:00"><meta property="article:modified_time" content="2024-09-10T00:00:00+09:00"><meta property="og:image" content="https://blog.nishipy.com/p/oc-mirror-v2-image-deletion/mirror.jpg"><meta name=twitter:site content="@iamnishipy"><meta name=twitter:creator content="@iamnishipy"><meta name=twitter:title content="oc-mirror v2で遊んでみた"><meta name=twitter:description content="Header Photo by Ivan Rohovchenko on Unsplash
oc-mirror plugin v2 インターネット接続性のない環境では、OpenShiftのインストールに必要なコンテナイメージやOperatorが使うコンテナイメージを、Red Hatが公開するインターネット上のコンテナレジストリからミラーレジストリにミラーリングする必要があります。そんなときに便利なoc-mirror pluginですが、バグの多いの機能の改善や再実装、新機能の追加をしたoc-mirror plugin v2の開発が進められています。詳細は、OpenShift 4.16のリリースノートのこの辺りをご確認ください。
なお、OpenShift 4.16時点では、oc-mirror plugin v2によるミラーリングはTech Previewです。
今回は、oc-mirror plugin v2で追加された、ミラーレジストリ上にあるイメージ削除の機能で遊んでみたいと思います。
oc-mirror pluginによるミラーリングとイメージ削除 従来のoc-mirror v1では、ミラーリング実行時に、前回までのミラーリングの履歴から自動でイメージをプルーニングするため、利用者が明示的にイメージを削除することはありませんでした。 この挙動は一見便利そうですが、ImageSetConfiguration という設定ファイルをわりと作成・更新しないと意図しないイメージを消してしまうこともしばしばありました。またバグが報告されることも多かったそうで、oc-mirror plugin v2では、自動でプルーニングを行わないように根本的に実装が見直されています。
DeleteImageSetConfiguration の導入 oc-mirror では、ImageSetConfiguration という設定ファイルにミラーリング対象のコンテナイメージを定義していました。v1では、このファイルの変更履歴から削除対象となるイメージを自動で算出していたわけですが、v2からは DeleteImageSetConfiguration が導入され、ImageSetConfiguration と同じような書式で削除したいイメージを明示的に定義することができます。
oc-mirror v2でイメージ削除してみる イメージのミラーリング ミラーレジストリからイメージを削除してみたいのですが、そもそも消すイメージがないので、まずミラーリングを実行します。以下のような内容の ImageSetConfiguration で、OpenShift 4.16.5 と 4.16.6のリリースイメージをミラーリングしてみます。v1と比較して、CRD(のようなもの)のkindは同じですが、apiVersion が異なるため注意してください。
1 2 3 4 5 6 7 8 kind: ImageSetConfiguration apiVersion: mirror.openshift.io/v2alpha1 mirror: platform: channels: - name: stable-4.16 minVersion: 4.16.5 maxVersion: 4."><meta name=twitter:card content="summary"><meta name=twitter:image content="https://blog.nishipy.com/p/oc-mirror-v2-image-deletion/mirror.jpg"><link rel="shortcut icon" href=/images/favicon.ico><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4768526216432204" crossorigin=anonymous></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/favicon.ico width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🐈</span></figure><div class=site-meta><h1 class=site-name><a href=/>/home/nishipy</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/nishipy target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/iamnishipy target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://nishipy.com target=_blank title=Blog rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language-hiragana" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M7 4c0 4.846.0 7 .5 8"/><path d="M10 8.5c0 2.286-2 4.5-3.5 4.5S4 11.865 4 11c0-2 1-3 3-3s5 .57 5 2.857c0 1.524-.667 2.571-2 3.143"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828A4 4 0 109.172 9.172a4 4 0 005.656 5.656z"/><path d="M6.343 17.657l-1.414 1.414"/><path d="M6.343 6.343 4.929 4.929"/><path d="M17.657 6.343l1.414-1.414"/><path d="M17.657 17.657l1.414 1.414"/><path d="M4 12H2"/><path d="M12 4V2"/><path d="M20 12h2"/><path d="M12 20v2"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#oc-mirror-plugin-v2>oc-mirror plugin v2</a></li><li><a href=#oc-mirror-pluginによるミラーリングとイメージ削除>oc-mirror pluginによるミラーリングとイメージ削除</a><ul><li><a href=#deleteimagesetconfiguration-の導入><code>DeleteImageSetConfiguration</code> の導入</a></li></ul></li><li><a href=#oc-mirror-v2でイメージ削除してみる>oc-mirror v2でイメージ削除してみる</a><ul><li><a href=#イメージのミラーリング>イメージのミラーリング</a></li><li><a href=#deleteimagesetconfiguration-によるイメージの削除><code>DeleteImageSetConfiguration</code> によるイメージの削除</a></li></ul></li><li><a href=#余談>余談</a><ul><li><a href=#oc-mirror-v2のイメージ削除の注意点>oc-mirror v2のイメージ削除の注意点</a></li><li><a href=#oc-mirror-on-rhel-8>oc-mirror on RHEL 8</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/oc-mirror-v2-image-deletion/><img src=/p/oc-mirror-v2-image-deletion/mirror_hu5459c0360c2b0cb7a147d2df0eb350ca_1507826_800x0_resize_q75_box.jpg srcset="/p/oc-mirror-v2-image-deletion/mirror_hu5459c0360c2b0cb7a147d2df0eb350ca_1507826_800x0_resize_q75_box.jpg 800w, /p/oc-mirror-v2-image-deletion/mirror_hu5459c0360c2b0cb7a147d2df0eb350ca_1507826_1600x0_resize_q75_box.jpg 1600w" width=800 height=597 loading=lazy alt="Featured image of post oc-mirror v2で遊んでみた"></a></div><div class=article-details><header class=article-category><a href=/categories/openshift/>openshift</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/oc-mirror-v2-image-deletion/>oc-mirror v2で遊んでみた</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 10, 2024</time></div></footer></div></header><section class=article-content><section class="toc toc--inline"><h2>Table of contents</h2><div><nav id=TableOfContents><ul><li><a href=#oc-mirror-plugin-v2>oc-mirror plugin v2</a></li><li><a href=#oc-mirror-pluginによるミラーリングとイメージ削除>oc-mirror pluginによるミラーリングとイメージ削除</a><ul><li><a href=#deleteimagesetconfiguration-の導入><code>DeleteImageSetConfiguration</code> の導入</a></li></ul></li><li><a href=#oc-mirror-v2でイメージ削除してみる>oc-mirror v2でイメージ削除してみる</a><ul><li><a href=#イメージのミラーリング>イメージのミラーリング</a></li><li><a href=#deleteimagesetconfiguration-によるイメージの削除><code>DeleteImageSetConfiguration</code> によるイメージの削除</a></li></ul></li><li><a href=#余談>余談</a><ul><li><a href=#oc-mirror-v2のイメージ削除の注意点>oc-mirror v2のイメージ削除の注意点</a></li><li><a href=#oc-mirror-on-rhel-8>oc-mirror on RHEL 8</a></li></ul></li></ul></nav></div></section><p>Header Photo by <a class=link href=https://unsplash.com/ja/@ivrn target=_blank rel=noopener>Ivan Rohovchenko</a> on <a class=link href=https://unsplash.com/photos/black-telescope-during-day-time-8SjeH5pZbjw target=_blank rel=noopener>Unsplash</a></p><h2 id=oc-mirror-plugin-v2>oc-mirror plugin v2</h2><p>インターネット接続性のない環境では、OpenShiftのインストールに必要なコンテナイメージやOperatorが使うコンテナイメージを、Red Hatが公開するインターネット上のコンテナレジストリからミラーレジストリにミラーリングする必要があります。そんなときに便利なoc-mirror pluginですが、バグの多いの機能の改善や再実装、新機能の追加をした<a class=link href=https://github.com/openshift/oc-mirror/tree/main/v2 target=_blank rel=noopener>oc-mirror plugin v2</a>の開発が進められています。詳細は、<a class=link href=https://docs.openshift.com/container-platform/4.16/release_notes/ocp-4-16-release-notes.html#ocp-4-16-oc-mirror-v2_release-notes target=_blank rel=noopener>OpenShift 4.16のリリースノートのこの辺り</a>をご確認ください。</p><p>なお、<a class=link href=https://docs.openshift.com/container-platform/4.16/installing/disconnected_install/about-installing-oc-mirror-v2.html target=_blank rel=noopener>OpenShift 4.16時点では、oc-mirror plugin v2によるミラーリングはTech Preview</a>です。</p><p>今回は、oc-mirror plugin v2で追加された、ミラーレジストリ上にあるイメージ削除の機能で遊んでみたいと思います。</p><h2 id=oc-mirror-pluginによるミラーリングとイメージ削除>oc-mirror pluginによるミラーリングとイメージ削除</h2><p>従来のoc-mirror v1では、ミラーリング実行時に、前回までのミラーリングの履歴から自動でイメージをプルーニングするため、利用者が明示的にイメージを削除することはありませんでした。
この挙動は一見便利そうですが、<code>ImageSetConfiguration</code> という設定ファイルをわりと作成・更新しないと意図しないイメージを消してしまうこともしばしばありました。またバグが報告されることも多かったそうで、oc-mirror plugin v2では、自動でプルーニングを行わないように根本的に実装が見直されています。</p><h3 id=deleteimagesetconfiguration-の導入><code>DeleteImageSetConfiguration</code> の導入</h3><p>oc-mirror では、<code>ImageSetConfiguration</code> という設定ファイルにミラーリング対象のコンテナイメージを定義していました。v1では、このファイルの変更履歴から削除対象となるイメージを自動で算出していたわけですが、v2からは <code>DeleteImageSetConfiguration</code> が導入され、<code>ImageSetConfiguration</code> と同じような書式で削除したいイメージを明示的に定義することができます。</p><h2 id=oc-mirror-v2でイメージ削除してみる>oc-mirror v2でイメージ削除してみる</h2><h3 id=イメージのミラーリング>イメージのミラーリング</h3><p>ミラーレジストリからイメージを削除してみたいのですが、そもそも消すイメージがないので、まずミラーリングを実行します。以下のような内容の <code>ImageSetConfiguration</code> で、OpenShift 4.16.5 と 4.16.6のリリースイメージをミラーリングしてみます。v1と比較して、CRD(のようなもの)の<code>kind</code>は同じですが、<code>apiVersion</code> が異なるため注意してください。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ImageSetConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>mirror.openshift.io/v2alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>mirror</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>platform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>channels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>stable-4.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>minVersion</span><span class=p>:</span><span class=w> </span><span class=m>4.16.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>maxVersion</span><span class=p>:</span><span class=w> </span><span class=m>4.16.6</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>なお、ミラーレジストリには、<a class=link href=https://docs.openshift.com/container-platform/4.16/installing/disconnected_install/installing-mirroring-creating-registry.html target=_blank rel=noopener>Mirror registry for Red Hat OpenShift</a>を使うのが簡単です。OpenShiftインストールのためのミラーリング用途限定で、PodmanでRed Hat Quayをデプロイしてくれます。この記事ではミラーレジストリの構築は省略します。</p><p>ミラーレジストリへログイン後、ミラーリングを実行します。</p><pre tabindex=0><code>$ podman login registry.ocp4.tanishim.local:8443 -u init --authfile mirror-pull-secret.txt
Password:
Login Succeeded!

$ oc mirror --v2 --authfile mirror-pull-secret.txt -c ./imagesetconfig.yaml --workspace file://./v2-workspace docker://registry.ocp4.tanishim.local:8443
...
2024/09/04 16:14:01  [INFO]   : _  setting up the environment for you...
2024/09/04 16:14:01  [INFO]   : __ workflow mode: mirrorToMirror
2024/09/04 16:14:01  [INFO]   : _  going to discover the necessary images...
2024/09/04 16:14:01  [INFO]   : __ collecting release images...
2024/09/04 16:14:02  [INFO]   : __ collecting operator images...
2024/09/04 16:14:02  [INFO]   : __ collecting additional images...
2024/09/04 16:14:02  [INFO]   : __ Start copying the images...
2024/09/04 16:14:05  [INFO]   : === Overall Progress -  image 1 / 384 ===
2024/09/04 16:14:05  [INFO]   :  release image 1 / 384
2024/09/04 16:14:05  [INFO]   :  image: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:5bb98edf376dfa838ce6899b0fc0e867237f34df63e8bf476d0ba9d2195131bd
2024/09/04 16:14:05  [INFO]   : =========================================
2024/09/04 16:14:07  [INFO]   : === Overall Progress -  image 2 / 384 ===
2024/09/04 16:14:07  [INFO]   :  release image 2 / 384
2024/09/04 16:14:07  [INFO]   :  image: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:6a8a7825b2039759548c6d83db384979cf4bf0a17d231c2a588c57e80623f74c
2024/09/04 16:14:07  [INFO]   : =========================================
2024/09/04 16:14:15  [INFO]   : === Overall Progress -  image 3 / 384 ===
2024/09/04 16:14:15  [INFO]   :  release image 3 / 384
2024/09/04 16:14:15  [INFO]   :  image: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:667efccd05c2154ebda8ae7a14fbb3ed4523ad8c1f459df9eda77a041239ae1c
2024/09/04 16:14:15  [INFO]   : =========================================
2024/09/04 16:14:19  [INFO]   : === Overall Progress -  image 4 / 384 ===
2024/09/04 16:14:19  [INFO]   :  release image 4 / 384
2024/09/04 16:14:19  [INFO]   :  image: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:355407f1b51db63278a581de341542521972e68c607a0e10f521733795619214
2024/09/04 16:14:19  [INFO]   : =========================================
2024/09/04 16:14:26  [INFO]   : === Overall Progress -  image 5 / 384 ===
2024/09/04 16:14:26  [INFO]   :  release image 5 / 384
2024/09/04 16:14:26  [INFO]   :  image: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:041d983c6807129d0e0cf371133f8a1c0d5fde78a813c60aa1f293e64004fb43
2024/09/04 16:14:26  [INFO]   : =========================================
__2024/09/04 16:14:31  [INFO]   : === Overall Progress -  image 6 / 384 ===
2024/09/04 16:14:31  [INFO]   :  release image 6 / 384
...
2024/09/04 17:58:09  [INFO]   : === Overall Progress -  image 384 / 384 ===
2024/09/04 17:58:09  [INFO]   :  release image 384 / 384
2024/09/04 17:58:09  [INFO]   :  image: quay.io/openshift-release-dev/ocp-release:4.16.5-x86_64
2024/09/04 17:58:09  [INFO]   : ===========================================
2024/09/04 17:58:09  [INFO]   : === Results ===
2024/09/04 17:58:09  [INFO]   : All release images mirrored successfully 384 / 384 __
2024/09/04 17:58:09  [INFO]   : __ Generating IDMS file...
2024/09/04 17:58:09  [INFO]   : v2-workspace/working-dir/cluster-resources/idms-oc-mirror.yaml file created
2024/09/04 17:58:09  [INFO]   : __ Generating ITMS file...
2024/09/04 17:58:09  [INFO]   : v2-workspace/working-dir/cluster-resources/itms-oc-mirror.yaml file created
2024/09/04 17:58:09  [INFO]   : __ No catalogs mirrored. Skipping CatalogSource file generation.
2024/09/04 17:58:09  [INFO]   : mirror time     : 1h44m7.951974594s
2024/09/04 17:58:09  [INFO]   : __ Goodbye, thank you for using oc-mirror
</code></pre><p>oc-mirrorを使ったことがある方ならわかると思いますが、標準出力されるログの見やすさが桁違いです。プログレスバーのように、ミラーリングの進捗がわかりやすいですし、タイムスタンプも有用です。
<code>--workspace</code> というフラグはoc-mirror v2で追加された便利機能の1つです。指定したディレクトリに、こんな感じでアーティファクトが生成されていました。ログやミラーしたOperator、OpenShift リリースの情報、インストール後クラスタに適用する <code>ImageDigestMirrorSet</code> および <code>ImageTagMirrorSet</code> のYAMLマニフェストが入ります</p><pre tabindex=0><code>$ tree v2-workspace/ -d
v2-workspace/
`-- working-dir
    |-- cluster-resources
    |-- hold-operator
    |-- hold-release
    |   `-- ocp-release
    |       |-- 4.16.5-x86_64
    |       |   `-- release-manifests
    |       `-- 4.16.6-x86_64
    |           `-- release-manifests
    |-- info
    |-- logs
    |-- release-filters
    |-- release-images
    |   `-- ocp-release
    |       |-- 4.16.5-x86_64
    |       |   `-- blobs
    |       |       `-- sha256
    |       `-- 4.16.6-x86_64
    |           `-- blobs
    |               `-- sha256
    `-- signatures
</code></pre><pre tabindex=0><code>$ cat v2-workspace/working-dir/cluster-resources/*.yaml
---
apiVersion: config.openshift.io/v1
kind: ImageDigestMirrorSet
metadata:
  name: idms-release-0
spec:
  imageDigestMirrors:
  - mirrors:
    - registry.ocp4.tanishim.local:8443/openshift-release-dev
    source: quay.io/openshift-release-dev
status: {}
---
apiVersion: config.openshift.io/v1
kind: ImageTagMirrorSet
metadata:
  name: itms-release-0
spec:
  imageTagMirrors:
  - mirrors:
    - registry.ocp4.tanishim.local:8443/openshift-release-dev
    source: quay.io/openshift-release-dev
status: {}
</code></pre><p>Mirror Registry側を念の為確認すると、今回ミラーリングしたOCP 4.16.5と4.16.6 のリリースイメージが入っています。</p><p><img src=/p/oc-mirror-v2-image-deletion/tag_history_1.jpg width=2602 height=1068 srcset="/p/oc-mirror-v2-image-deletion/tag_history_1_hu0533df8c600b6ebf5e775c57536fef00_178874_480x0_resize_q75_box.jpg 480w, /p/oc-mirror-v2-image-deletion/tag_history_1_hu0533df8c600b6ebf5e775c57536fef00_178874_1024x0_resize_q75_box.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=243 data-flex-basis=584px></p><h3 id=deleteimagesetconfiguration-によるイメージの削除><code>DeleteImageSetConfiguration</code> によるイメージの削除</h3><p>いよいよ本題です。4.16.5用のイメージだけを削除してみます。以下の内容で作成した <code>DeleteImageSetConfiguration</code> と先ほどミラーリングした際に生成されたメタデータを読み込んで、イメージ削除に必要な設定ファイルを生成します。<code>oc mirror delete</code> コマンドに <code>--generate</code> フラグをつけるという、なんともややこしい感じです。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>mirror.openshift.io/v2alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>DeleteImageSetConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>delete</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>platform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>channels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>stable-4.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>minVersion</span><span class=p>:</span><span class=w> </span><span class=m>4.16.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>maxVersion</span><span class=p>:</span><span class=w> </span><span class=m>4.16.5</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>$ oc mirror --v2 delete --generate --authfile mirror-pull-secret.txt --config deleteimagesetconfig.yaml --workspace file://./v2-workspace docker://registry.ocp4.tanishim.local:8443
2024/09/05 15:48:04  [WARN]   : _  --v2 flag identified, flow redirected to the oc-mirror v2 version. This is Tech Preview, it is still under development and it is not production ready.
2024/09/05 15:48:04  [INFO]   : __ Hello, welcome to oc-mirror
2024/09/05 15:48:04  [INFO]   : _  setting up the environment for you...
2024/09/05 15:48:04  [INFO]   : __ workflow mode: mirrorToMirror / delete
2024/09/05 15:48:04  [INFO]   : _  going to discover the necessary images...
2024/09/05 15:48:04  [INFO]   : __ collecting release images...
2024/09/05 15:48:04  [INFO]   : __ collecting operator images...
2024/09/05 15:48:04  [INFO]   : __ collecting additional images...
2024/09/05 15:48:04  [INFO]   : __ Generating delete file...
2024/09/05 15:48:04  [INFO]   : v2-workspace/working-dir/delete file created
v2-workspace/working-dir/delete2024/09/05 15:49:31  [INFO]   : delete time     : 1m26.960963111s
2024/09/05 15:49:31  [INFO]   : __ Goodbye, thank you for using oc-mirror
</code></pre><p><code>v2-workspace/working-dir/delete</code> に何か作ってくれたようです。見てみましょう。</p><pre tabindex=0><code>$ ls v2-workspace/working-dir/delete
delete-images.yaml  delete-imageset-config.yaml

$ cat v2-workspace/working-dir/delete/delete-imageset-config.yaml
apiVersion: mirror.openshift.io/v2alpha1
delete:
  helm: {}
  platform:
    architectures:
    - amd64
    channels:
    - maxVersion: 4.16.5
      minVersion: 4.16.5
      name: stable-4.16
      type: ocp
kind: DeleteImageSetConfiguration

$ cat v2-workspace/working-dir/delete/delete-images.yaml
...
- imageName: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ffeb6edc9f09e75011c3547b2149b8120c68e7721d8ba2e7a6d659e6c83229bc
  imageReference: docker://registry.ocp4.tanishim.local:8443/openshift-release-dev/ocp-v4.0-art-dev@sha256:ffeb6edc9f09e75011c3547b2149b8120c68e7721d8ba2e7a6d659e6c83229bc
  relatedBlobs:
  - sha256:86592d87dea5f0c55992dc4aadd236cde96f5e4f3d3dfd0456ca38dca2d2e151
  - sha256:9a0e86afac7b17960e2411a55e234d639aead65defac982719003eaa242da807
  - sha256:b958cf13e572cbd92209b5c01a8e65203cf88c4b017258ec8ff9bfd5d722b715
  - sha256:ca1636478fe5b8e2a56600e24d6759147feb15020824334f4a798c1cb6ed58e2
  - sha256:e5e8178c6af6b5832361eb52e25232f851a6979c63bbad694e063afdd71ca459
  - sha256:ffeb6edc9f09e75011c3547b2149b8120c68e7721d8ba2e7a6d659e6c83229bc
kind: DeleteImageList
</code></pre><p><code>DeleteImageSetConfiguration</code> と <code>DeleteImageList</code> のマニフェストが作成されています。前者は先ほど自分で与えたファイルと同じ内容です。後者は、それを元に実際に削除対象となるイメージとダイジェストをリストにしたもののようです。この段階ではイメージの削除は行われていません。先ほど生成された <code>DeleteImageList</code> のYAMLファイル <code>delete-images.yaml</code>を使って削除処理を実行します。</p><pre tabindex=0><code>$ oc mirror --v2 delete --authfile mirror-pull-secret.txt --delete-yaml-file ./v2-workspace/working-dir/delete/delete-images.yaml docker://registry.ocp4.tanishim.local:8443
...
2024/09/05 16:01:03  [INFO]   :  image: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ffbe0d4c61d5a2e42923b1d063179bbd99fe2bf7a679c5a2f1ae444ba0d5d6c6
2024/09/05 16:01:03  [INFO]   : ===========================================
2024/09/05 16:01:03  [INFO]   : === Overall Progress -  image 192 / 192 ===
2024/09/05 16:01:03  [INFO]   :  image: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ffeb6edc9f09e75011c3547b2149b8120c68e7721d8ba2e7a6d659e6c83229bc
2024/09/05 16:01:03  [INFO]   : ===========================================
2024/09/05 16:01:03  [INFO]   : === Results ===
2024/09/05 16:01:03  [INFO]   : All images deleted successfully 192 / 192 __
2024/09/05 16:01:03  [INFO]   : delete time     : 1m33.308334555s
2024/09/05 16:01:03  [INFO]   : __ Remember to execute a garbage collect (or similar) on your remote repository
2024/09/05 16:01:03  [INFO]   : __ Goodbye, thank you for using oc-mirror
</code></pre><p>完了後、ミラーレジストリを見てみると、期待した通り、4.16.5のリリースイメージ(のタグ)だけが削除されたことが確認できます。</p><p><img src=/p/oc-mirror-v2-image-deletion/tag-history-2.jpg width=2542 height=844 srcset="/p/oc-mirror-v2-image-deletion/tag-history-2_hu0533df8c600b6ebf5e775c57536fef00_127757_480x0_resize_q75_box.jpg 480w, /p/oc-mirror-v2-image-deletion/tag-history-2_hu0533df8c600b6ebf5e775c57536fef00_127757_1024x0_resize_q75_box.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=301 data-flex-basis=722px></p><p><img src=/p/oc-mirror-v2-image-deletion/tag-history-3.jpg width=2684 height=1204 srcset="/p/oc-mirror-v2-image-deletion/tag-history-3_hu0533df8c600b6ebf5e775c57536fef00_216348_480x0_resize_q75_box.jpg 480w, /p/oc-mirror-v2-image-deletion/tag-history-3_hu0533df8c600b6ebf5e775c57536fef00_216348_1024x0_resize_q75_box.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=222 data-flex-basis=535px></p><h2 id=余談>余談</h2><h3 id=oc-mirror-v2のイメージ削除の注意点>oc-mirror v2のイメージ削除の注意点</h3><p>oc-mirror v2の新機能である <code>DeleteImageSetConfiguration</code> によるイメージ削除では、イメージのマニフェストのみを削除しています。そのため、ストレージの使用量は減りません。不要なイメージの実体を削除し、ストレージを空けたい場合は、コンテナレジストリ側でガーベージコレクションを有効にしてください。なお、<a class=link href=https://docs.redhat.com/en/documentation/red_hat_quay/3/html/manage_red_hat_quay/garbage-collection#garbage-collection-configuration-fields target=_blank rel=noopener>Red Hat Quay では、ガーベージコレクションはデフォルトで有効</a>になっています。今回使ったOpenShift Mirror Registryも中身はQuayなので同様です。</p><h3 id=oc-mirror-on-rhel-8>oc-mirror on RHEL 8</h3><p>最近のバージョンのoc-mirrorをRHEL 8で実行しようとすると、以下のようなエラーが出るかもしれません。</p><pre tabindex=0><code>/lib64/libc.so.6: version `GLIBC_2.33&#39; not found
</code></pre><p>RHEL 8の<code>glibc</code> のバージョンが、<code>glibc-2.28</code> であるためです。このような場合、RHEL 8のマシンでUBI 9なPodmanコンテナで一時対処する方法があります。以下のようにコンテナを実行し、bashセッションを起動して、oc-mirrorを試せばよいでしょう。必要であれば、ホストOS上にあるミラーレジストリのプルシークレットやCA証明書をコピーします。</p><pre tabindex=0><code>$ podman run -dt -v ./:/oc-mirror:Z --name ubi9 registry.redhat.io/ubi9
$ podman exec -it ubi9 /bin/bash
</code></pre></section><footer class=article-footer><section class=article-tags><a href=/tags/openshift/>openshift</a>
<a href=/tags/podman/>podman</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section><section class=share-buttons><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=oc-mirror%20v2%e3%81%a7%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%81%9f&url=https%3a%2f%2fblog.nishipy.com%2fp%2foc-mirror-v2-image-deletion%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nishipy.com%2fp%2foc-mirror-v2-image-deletion%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nishipy.com%2fp%2foc-mirror-v2-image-deletion%2f&title=oc-mirror%20v2%e3%81%a7%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%81%9f&summary=oc-mirror%20v2%e3%81%a7%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%81%9f&source=https%3a%2f%2fblog.nishipy.com%2fp%2foc-mirror-v2-image-deletion%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6.0 2.5 1 2.6 2.5.0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fblog.nishipy.com%2fp%2foc-mirror-v2-image-deletion%2f&resubmit=true&title=oc-mirror%20v2%e3%81%a7%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%81%9f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=oc-mirror%20v2%e3%81%a7%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%81%9f%20https%3a%2f%2fblog.nishipy.com%2fp%2foc-mirror-v2-image-deletion%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/otel-openshift/><div class=article-image><img src=/p/otel-openshift/telescope.c5b27c8f36fa1fee8773ae8b927926a3_hu5459c0360c2b0cb7a147d2df0eb350ca_2986981_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Red Hat build of OpenTelemetryで遊んでみた" data-key=otel-openshift data-hash="md5-xbJ8jzb6H+6Hc66Lknkmow=="></div><div class=article-details><h2 class=article-title>Red Hat build of OpenTelemetryで遊んでみた</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 /home/nishipy</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>